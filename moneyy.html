<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Money Tracker</title>
    <link rel="icon" href="picture/money.png" />

    <style>
      body {
        font-family: Noto Sans, Arial, sans-serif;
        padding: 18px;
        background: #f7f8fa;
        color: #111;
      }
      .card {
        background: white;
        padding: 16px;
        border-radius: 20px;
        box-shadow: 0 6px 18px rgba(20, 20, 20, 0.06);
        max-width: 780px;
        margin: auto;
        margin-top: 40px;
      }
      h1 {
        font-size: 20px;
        margin: 0 0 10px 0;
      }
      .row {
        display: flex;
        gap: 8px;
        margin: 10px 0;
      }
      input[type="number"] {
        flex: 1;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      button {
        padding: 10px 14px;
        border-radius: 8px;
        border: none;
        font-weight: 600;
        cursor: pointer;
      }
      button.primary {
        background: #1abf54;
        color: white;
        transition: 0.1s;
      }
      /* button.primary:hover {
        opacity: 0.5;
        transform: translate(3px, 5px) scale(1.2);
      } */
       
      button.primary:active {
        /* opacity: 0.4; */
        /* transform: translate(3px, 5px) scaleX(1.2);
        */
        background: #055b23;

      } 
      .deleteBtn {
        background: #ef4444;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 6px;
        cursor: pointer;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 14px;
      }
      th,
      td {
        padding: 8px 10px;
        border-bottom: 1px solid #eee;
        text-align: left;
        font-size: 14px;
      }
      .totals-box {
        margin-top: 15px;
        background: #f2f4f7;
        padding: 12px;
        border-radius: 12px;
        font-size: 14px;
        line-height: 1.8;
      }
      .totals-box span {
        font-weight: bold;
      }
      /* .typewrite {
        color: Orange;
        font-size: 25px;
      } */
    </style>
  </head>

  <body>
    <div class="card">
      <center>
        <!-- <h1
          class="typewrite"
          data-period="2000"
          data-type='[ "â›½ï¸ áá˜áŸ’á›áŸƒá”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹áŸá¶áŸ†á„ â›½ï¸" ]'
        >
          <span class="wrap"></span>
        </h1> -->
        
        <h1>
          â›½ï¸ áá˜áŸ’á›áŸƒá”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹áŸá¶áŸ†á„ â›½ï¸
        </h1>
      </center>

      <br>
      <div style="font-size: 13px; color: #666">
        á”á‰áŸ’á…á¼á›áá˜áŸ’á›áŸƒ (á›áŸáá‚ááŸ‹) â†’ á…á»á… "á”á‰áŸ’á…á¼á›" â†’ áœá¶á“á¹á„ášá€áŸ’áŸá¶á‘á»á€ á“á·á„á”á¼á€áŸášá»á”áŸ”
      </div>

      <div class="row" style="margin-top: 12px">
        <input
          id="amountInput"
          type="number"
          placeholder="á”á‰áŸ’á…á¼á›á…áŸ†á“á½á“á›á»á™ á§.5000áŸ›"
          min="0"
        />
        <button class="primary" id="addBtn">á”á‰áŸ’á…á¼á›</button>
      </div>

      <!-- ONLY TOTAL -->
      <div class="totals-box">
        ğŸ§® áŸášá»á”á‘á¶áŸ†á„á¢áŸáŸ‹: <span id="allTotal">0 áŸ›</span>
      </div>

      <table>
        <thead>
          <tr>
            <th>á›.áš</th>
            <th>ááŸ’á„áŸƒ-ááŸ‚-á†áŸ’á“á¶áŸ† / á˜áŸ‰áŸ„á„</th>
            <th>áá˜áŸ’á›áŸƒ (áŸ›)</th>
            <th>á›á»á”</th>
          </tr>
        </thead>
        <tbody id="entriesTbody"></tbody>
      </table>
    </div>

    <script>
      const STORAGE_KEY = "moneyEntries_khr_v1";

      const currencyFmt = new Intl.NumberFormat("km-KH", {
        style: "currency",
        currency: "KHR",
        maximumFractionDigits: 0,
      });

      function formatDateTime(iso) {
        const d = new Date(iso);
        return d.toLocaleString("km-KH", {
          year: "numeric",
          month: "short",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      function loadEntries() {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        try {
          return JSON.parse(raw);
        } catch {
          return [];
        }
      }

      function saveEntries(list) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
      }

      function deleteEntry(index) {
        const entries = loadEntries();
        entries.splice(index, 1);
        saveEntries(entries);
        render();
      }

      function render() {
        const tbody = document.getElementById("entriesTbody");
        tbody.innerHTML = "";

        const entries = loadEntries().sort(
          (a, b) => new Date(b.date) - new Date(a.date)
        );

        let idx = 1;
        entries.forEach((e, i) => {
          const tr = document.createElement("tr");

          tr.innerHTML = `
            <td>${idx++}</td>
            <td>${formatDateTime(e.date)}</td>
            <td>${currencyFmt.format(e.amount).replace(/\u00A0/g, " ")}</td>
            <td><button class="deleteBtn">X</button></td>
          `;

          tr.querySelector(".deleteBtn").onclick = () => {
            if (confirm("á…á„áŸ‹á›á»á”á‘á·á“áŸ’á“áŸá™á“áŸáŸ‡á˜áŸ‚á“á‘áŸ?")) deleteEntry(i);
          };

          tbody.appendChild(tr);
        });

        updateTotals(entries);
      }

      function updateTotals(entries) {
        let allSum = 0;

        for (const e of entries) {
          const amt = Number(e.amount) || 0;
          allSum += amt;
        }

        document.getElementById("allTotal").textContent =
          currencyFmt.format(allSum).replace(/\u00A0/g, " ");
      }

      function addEntry(amount) {
        if (!amount || amount <= 0) return;

        const entries = loadEntries();
        entries.push({
          amount: Math.round(Number(amount)),
          date: new Date().toISOString(),
        });

        saveEntries(entries);
        render();
      }

      document.getElementById("addBtn").addEventListener("click", () => {
        const input = document.getElementById("amountInput");
        const val = Number(input.value);

        if (!val || val <= 0) {
          alert("áŸá¼á˜á”á‰áŸ’á…á¼á›á…áŸ†á“á½á“ááŸ’ášá¹á˜ááŸ’ášá¼áœ (á›á¾áŸ 0)áŸ”");
          return;
        }

        addEntry(val);
        input.value = "";
        input.focus();
      });

      document
        .getElementById("amountInput")
        .addEventListener("keydown", ev => {
          if (ev.key === "Enter") {
            ev.preventDefault();
            document.getElementById("addBtn").click();
          }
        });

      // Typewriter effect
      // var TxtType = function(el, toRotate, period) {
      //   this.toRotate = toRotate;
      //   this.el = el;
      //   this.loopNum = 0;
      //   this.period = parseInt(period, 10) || 2000;
      //   this.txt = '';
      //   this.tick();
      //   this.isDeleting = false;
      // };

      // TxtType.prototype.tick = function() {
      //   var i = this.loopNum % this.toRotate.length;
      //   var fullTxt = this.toRotate[i];

      //   if (this.isDeleting) {
      //     this.txt = fullTxt.substring(0, this.txt.length - 1);
      //   } else {
      //     this.txt = fullTxt.substring(0, this.txt.length + 1);
      //   }

      //   this.el.innerHTML = '<span class="wrap">'+this.txt+'</span>';

      //   var that = this;
      //   var delta = 200 - Math.random() * 100;

      //   if (this.isDeleting) { delta /= 2; }

      //   if (!this.isDeleting && this.txt === fullTxt) {
      //     delta = this.period;
      //     this.isDeleting = true;
      //   } else if (this.isDeleting && this.txt === '') {
      //     this.isDeleting = false;
      //     this.loopNum++;
      //     delta = 500;
      //   }

      //   setTimeout(function() {
      //     that.tick();
      //   }, delta);
      // };

      // window.onload = function() {
      //   var elements = document.getElementsByClassName('typewrite');
      //   for (var i=0; i<elements.length; i++) {
      //     var toRotate = elements[i].getAttribute('data-type');
      //     var period = elements[i].getAttribute('data-period');
      //     if (toRotate) {
      //       new TxtType(elements[i], JSON.parse(toRotate), period);
      //     }
      //   }
      // };

      render();
    </script>
  </body>
</html>
